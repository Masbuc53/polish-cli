# API Documentation

This document provides comprehensive documentation for using Polish programmatically in your applications.

## Overview

Polish provides a JavaScript/TypeScript API that allows you to integrate file organization capabilities into your own applications. The API is designed to be flexible and easy to use.

## Installation

```bash
npm install polish-cli
```

## Core Classes

### Polish

The main class for file organization operations.

```typescript
import { Polish } from 'polish-cli';

// Create instance with default configuration
const polish = new Polish();

// Create instance with custom configuration
const polish = new Polish(config);

// Create instance with specific profile
const polish = new Polish(undefined, 'my-profile');
```

#### Constructor

```typescript
constructor(config?: Config, profileName?: string)
```

- `config`: Optional configuration object
- `profileName`: Optional profile name to use

#### Methods

##### `loadConfig(): Promise<void>`

Load configuration from the active profile.

```typescript
await polish.loadConfig();
```

##### `organize(options: OrganizeOptions): Promise<OrganizeResult>`

Organize files according to configuration.

```typescript
const result = await polish.organize({
  sources: ['/path/to/source'],
  dryRun: false,
  copy: false,
  onProgress: (current, total, file) => {
    console.log(`Processing ${file.name} (${current}/${total})`);
  }
});
```

**Options:**
- `sources`: Array of source paths to process
- `dryRun`: Preview mode, don't actually move files
- `copy`: Copy files instead of moving them
- `onProgress`: Callback function for progress updates

**Returns:**
```typescript
interface OrganizeResult {
  summary: {
    successful: number;
    failed: number;
    duration: number;
  };
  processed: ProcessedFile[];
  failed: FailedFile[];
}
```

##### `analyze(options: AnalyzeOptions): Promise<AnalyzeResult>`

Analyze files without organizing them.

```typescript
const result = await polish.analyze({
  sources: ['/path/to/source'],
  types: ['pdf', 'txt', 'md']
});
```

### ProfileManager

Manages multiple profiles and configurations.

```typescript
import { ProfileManager } from 'polish-cli';

const profileManager = new ProfileManager();
await profileManager.initialize();
```

#### Methods

##### `createProfile(name: string, config: Config, description?: string): Promise<Profile>`

Create a new profile.

```typescript
const profile = await profileManager.createProfile('work', {
  vault: { path: '/path/to/work/vault' },
  originals: { path: '/path/to/work/files' },
  // ... other config
}, 'Work profile');
```

##### `getProfile(name: string): Promise<Profile | null>`

Get a specific profile.

```typescript
const profile = await profileManager.getProfile('work');
```

##### `listProfiles(): Promise<ProfileSummary[]>`

List all available profiles.

```typescript
const profiles = await profileManager.listProfiles();
profiles.forEach(profile => {
  console.log(`${profile.name}: ${profile.description}`);
});
```

##### `setActiveProfile(name: string): Promise<void>`

Set the active profile.

```typescript
await profileManager.setActiveProfile('work');
```

##### `deleteProfile(name: string): Promise<void>`

Delete a profile.

```typescript
await profileManager.deleteProfile('old-profile');
```

## Configuration

### Config Interface

```typescript
interface Config {
  vault: VaultConfig;
  originals: OriginalsConfig;
  sources: SourceConfig[];
  processing: ProcessingConfig;
  tagging: TaggingConfig;
  api: ApiConfig;
}
```

### VaultConfig

```typescript
interface VaultConfig {
  path: string;
  structure: {
    documents: string;
    media: string;
    code: string;
    references: string;
  };
}
```

### OriginalsConfig

```typescript
interface OriginalsConfig {
  path: string;
  organizationStyle: 'type-based' | 'date-based' | 'project-based';
  createYearFolders: boolean;
  preserveStructure: boolean;
}
```

### SourceConfig

```typescript
interface SourceConfig {
  path: string;
  includeSubfolders: boolean;
  excludePatterns: string[];
}
```

### ProcessingConfig

```typescript
interface ProcessingConfig {
  extractText: boolean;
  maxFileSize: string;
  supportedFormats: string[];
  timeout: number;
}
```

### TaggingConfig

```typescript
interface TaggingConfig {
  maxTags: number;
  autoGenerateTypeTags: boolean;
  autoGenerateDateTags: boolean;
  autoGenerateSourceTags: boolean;
  customTagPatterns: Record<string, string>;
  excludeTags: string[];
}
```

### ApiConfig

```typescript
interface ApiConfig {
  mode: 'claude-code' | 'claude-api' | 'hybrid' | 'local';
  timeout: number;
  retries: number;
  systemPrompt?: string;
}
```

## Usage Examples

### Basic File Organization

```typescript
import { Polish } from 'polish-cli';

async function organizeFiles() {
  const polish = new Polish();
  await polish.loadConfig();
  
  const result = await polish.organize({
    sources: ['/Users/username/Downloads'],
    dryRun: false,
    onProgress: (current, total, file) => {
      console.log(`Processing ${file.name} (${current}/${total})`);
    }
  });
  
  console.log(`Organized ${result.summary.successful} files`);
}
```

### Custom Configuration

```typescript
import { Polish } from 'polish-cli';

async function organizeWithCustomConfig() {
  const config = {
    vault: {
      path: '/path/to/vault',
      structure: {
        documents: 'Docs',
        media: 'Images',
        code: 'Scripts',
        references: 'Refs'
      }
    },
    originals: {
      path: '/path/to/organized',
      organizationStyle: 'date-based',
      createYearFolders: true,
      preserveStructure: false
    },
    sources: [
      { path: '/path/to/source', includeSubfolders: true, excludePatterns: ['*.tmp'] }
    ],
    processing: {
      extractText: true,
      maxFileSize: '10MB',
      supportedFormats: ['pdf', 'txt', 'md', 'png', 'jpg']
    },
    tagging: {
      maxTags: 5,
      autoGenerateTypeTags: true,
      autoGenerateDateTags: true,
      autoGenerateSourceTags: false,
      customTagPatterns: {},
      excludeTags: []
    },
    api: {
      mode: 'claude-code',
      timeout: 30000,
      retries: 3
    }
  };
  
  const polish = new Polish(config);
  const result = await polish.organize({
    sources: ['/path/to/files'],
    dryRun: false
  });
  
  console.log(`Processed ${result.processed.length} files`);
}
```

### Profile Management

```typescript
import { ProfileManager } from 'polish-cli';

async function manageProfiles() {
  const profileManager = new ProfileManager();
  await profileManager.initialize();
  
  // Create work profile
  await profileManager.createProfile('work', {
    vault: { path: '/path/to/work/vault' },
    originals: { path: '/path/to/work/files' },
    // ... other config
  }, 'Work documents');
  
  // Create personal profile
  await profileManager.createProfile('personal', {
    vault: { path: '/path/to/personal/vault' },
    originals: { path: '/path/to/personal/files' },
    // ... other config
  }, 'Personal documents');
  
  // List profiles
  const profiles = await profileManager.listProfiles();
  console.log('Available profiles:', profiles.map(p => p.name));
  
  // Switch to work profile
  await profileManager.setActiveProfile('work');
  
  // Use Polish with active profile
  const polish = new Polish();
  await polish.loadConfig();
  await polish.organize({ sources: ['/path/to/work/files'] });
}
```

### Error Handling

```typescript
import { Polish, PolishError } from 'polish-cli';

async function organizeWithErrorHandling() {
  try {
    const polish = new Polish();
    await polish.loadConfig();
    
    const result = await polish.organize({
      sources: ['/path/to/files'],
      dryRun: false
    });
    
    // Handle partial failures
    if (result.failed.length > 0) {
      console.warn(`${result.failed.length} files failed to process:`);
      result.failed.forEach(failure => {
        console.warn(`- ${failure.file.name}: ${failure.error}`);
      });
    }
    
  } catch (error) {
    if (error instanceof PolishError) {
      console.error('Polish error:', error.message);
      console.error('Error code:', error.code);
    } else {
      console.error('Unexpected error:', error);
    }
  }
}
```

### Progress Tracking

```typescript
import { Polish } from 'polish-cli';

async function organizeWithProgress() {
  const polish = new Polish();
  await polish.loadConfig();
  
  let processed = 0;
  let total = 0;
  
  const result = await polish.organize({
    sources: ['/path/to/files'],
    dryRun: false,
    onProgress: (current, totalFiles, file) => {
      processed = current;
      total = totalFiles;
      
      const percentage = Math.round((current / totalFiles) * 100);
      console.log(`Progress: ${percentage}% (${current}/${totalFiles}) - ${file.name}`);
    }
  });
  
  console.log(`Completed! Processed ${processed}/${total} files`);
}
```

### Batch Processing

```typescript
import { Polish } from 'polish-cli';

async function batchProcess() {
  const polish = new Polish();
  await polish.loadConfig();
  
  const directories = [
    '/path/to/dir1',
    '/path/to/dir2',
    '/path/to/dir3'
  ];
  
  for (const dir of directories) {
    console.log(`Processing ${dir}...`);
    
    try {
      const result = await polish.organize({
        sources: [dir],
        dryRun: false
      });
      
      console.log(`✓ ${dir}: ${result.summary.successful} files organized`);
      
    } catch (error) {
      console.error(`✗ ${dir}: ${error.message}`);
    }
  }
}
```

## Event Handling

Polish emits events during processing that you can listen to:

```typescript
import { Polish } from 'polish-cli';

async function organizeWithEvents() {
  const polish = new Polish();
  await polish.loadConfig();
  
  // Listen to events
  polish.on('fileProcessed', (file) => {
    console.log(`Processed: ${file.name}`);
  });
  
  polish.on('fileSkipped', (file, reason) => {
    console.log(`Skipped: ${file.name} (${reason})`);
  });
  
  polish.on('error', (error) => {
    console.error('Processing error:', error);
  });
  
  await polish.organize({
    sources: ['/path/to/files'],
    dryRun: false
  });
}
```

## Testing

When testing applications that use Polish:

```typescript
import { Polish } from 'polish-cli';

// Mock Polish for testing
jest.mock('polish-obsidian', () => ({
  Polish: jest.fn().mockImplementation(() => ({
    loadConfig: jest.fn(),
    organize: jest.fn().mockResolvedValue({
      summary: { successful: 1, failed: 0, duration: 100 },
      processed: [{ /* mock processed file */ }],
      failed: []
    })
  }))
}));

// Test your code
test('should organize files', async () => {
  const polish = new Polish();
  const result = await polish.organize({ sources: ['/test'] });
  
  expect(result.summary.successful).toBe(1);
});
```

## TypeScript Support

Polish is written in TypeScript and includes full type definitions. All interfaces and types are exported for use in your applications:

```typescript
import { 
  Polish, 
  ProfileManager, 
  Config, 
  OrganizeOptions, 
  OrganizeResult,
  Profile,
  ProcessedFile 
} from 'polish-cli';
```

## Next Steps

- Check the [examples directory](../examples/) for more usage examples
- Review the [CLI documentation](cli-reference.md) for command-line usage
- See the [configuration guide](configuration.md) for detailed configuration options